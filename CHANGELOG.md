# 更新日志

## v1.0.7 (2025-03-11)

### 修复
- 修复了 LevelDB 队列注册时机的问题，导致"不支持的队列类型"错误
- 优化了队列工厂的注册机制，将注册逻辑移至 init 函数中
- 改进了内存队列和 LevelDB 队列的初始化流程

## v1.0.6 (2025-03-11)

### 改进
- 优化了队列目录的创建和权限检查逻辑
- 增加了队列目录写权限的自动检测
- 改进了队列初始化的错误处理机制
- 优化了内存队列作为备用方案的切换逻辑

### 修复
- 修复了队列目录不存在时的自动创建功能
- 修复了队列初始化时的错误处理逻辑

## v1.0.5 (2025-03-11)

### 修复
- 修复了 LevelDB 队列创建时可能出现的"resource temporarily unavailable"错误
- 增强了 LevelDB 队列的错误处理和恢复机制
- 添加了自动降级到内存队列的功能，当 LevelDB 队列创建失败时

### 改进
- 增加了更详细的日志记录，以便更好地诊断问题
- 增强了对文件系统权限和锁定状态的检查

所有版本的重要更改都将记录在此文件中。

## [1.0.4] - 2024-01-09

### 改进

- 添加 HTTP 服务暴露队列指标数据
- 提供 `/metrics` 接口返回 JSON 格式指标
- 提供 `/health` 接口用于健康检查
- 支持配置 HTTP 服务端口和路径
- 新增 HTTPS 支持：
  - 可配置 HTTPS 开关
  - 支持自定义证书和私钥
  - 支持 HTTP 到 HTTPS 自动重定向
  - 可选强制 HTTPS 模式
  - 支持自定义 HTTPS 端口
- 新增 HTTP 接口认证机制：
  - 支持 API Key 认证
  - 可配置认证开关
  - 可自定义 API Key 和请求头
  - 提供访问日志和安全警告
- 新增更多队列监控指标：
  - 消息处理延迟（平均延迟和 P95 延迟）
  - 队列吞吐量（每分钟处理消息数）
  - 消息处理成功率
  - 平均重试次数
  - 队列积压程度
  - 总运行时间
- 改进配置文件管理：
  - 指定默认配置路径为 `/etc/tg-forward/config.yaml`
  - 支持多级配置文件查找
  - 支持通过环境变量指定配置路径
  - 自动创建配置目录
  - 统一安装包中的配置文件路径
  - 规范化配置文件权限和所有权

## [1.0.3] - 2025-03-10

### 改进

- 添加队列指标收集功能
- 支持每分钟统计队列状态
- 支持将指标输出到 JSON 文件
- 为对接 Prometheus 监控做准备

## [1.0.2] - 2025-03-10

### 改进

- 添加 systemd 服务支持
- 添加 SysV init 服务脚本
- 添加 RPM 和 DEB 打包支持
- 优化 Linux 系统部署流程

## [1.0.1] - 2025-03-10

### 改进

- 优化错误处理逻辑
- 改进日志输出格式
- 增强网络超时检测

## [1.0.0] - 2025-03-10

### 新增

- 初始版本发布
- 支持监听 Telegram 群聊消息
- 支持转发消息到钉钉机器人
- 支持处理网络超时和错误情况
- 支持消息重试机制
- 支持内存队列和 LevelDB 持久化队列
- 支持程序重启后恢复失败消息 